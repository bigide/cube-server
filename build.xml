<?xml version="1.0"?>

<!-- ======================================================================= -->
<!-- Cube Server Build File                                                  -->
<!-- ======================================================================= -->

<project name="cube-server" default="build-all" basedir=".">

	<property name="version.brand" value="3.0" />

	<property name="java.version" value="8" />

	<property name="project-common.dir" value="common" />
	<property name="project-dispatcher.dir" value="dispatcher" />
	<property name="project-service.dir" value="service" />

	<property name="project-service-messaging.dir" value="service-messaging" />

	<property name="build.dir" value="build" />

	<property name="deploy.dir" value="deploy" />

	<target name="init">
		<mkdir dir="${build.dir}" />
	</target>

	<!-- =================================================================== -->
	<!-- Builds common project                                               -->
	<!-- =================================================================== -->
	<target name="build-common">
		<ant antfile="build.xml"
			 dir="${project-common.dir}"
			 inheritall="false"
			 inheritrefs="false"
			 target="build-release" />
	</target>

	<!-- =================================================================== -->
	<!-- Builds dispatcher project                                           -->
	<!-- =================================================================== -->
	<target name="build-dispatcher" depends="build-common">
		<ant antfile="build.xml"
			 dir="${project-dispatcher.dir}"
			 inheritall="false"
			 inheritrefs="false"
			 target="build-release" />
	</target>

	<!-- =================================================================== -->
	<!-- Builds all service projects                                         -->
	<!-- =================================================================== -->
	<target name="build-service" depends="build-common">
		<ant antfile="build.xml"
			 dir="${project-service.dir}"
			 inheritall="false"
			 inheritrefs="false"
			 target="build-release" />
		<ant antfile="build.xml"
			 dir="${project-service-messaging.dir}"
			 inheritall="false"
			 inheritrefs="false"
			 target="build-release" />
	</target>

	<!-- =================================================================== -->
	<!-- Deploy all projects                                                 -->
	<!-- =================================================================== -->
	<target name="deploy" depends="build-all">
		<copy todir="${deploy.dir}/libs/">
			<fileset dir="${build.dir}">
				<include name="*.jar" />
			</fileset>
		</copy>
	</target>

	<!-- =================================================================== -->
	<!-- Clean deploy files                                                  -->
	<!-- =================================================================== -->
	<target name="clean-deploy">
		<delete failonerror="false" includeemptydirs="true">
			<fileset dir="${deploy.dir}/libs/">
				<include name="cube-common-*.jar" />
				<include name="cube-dispatcher-*.jar" />
				<include name="cube-service-*.jar" />
			</fileset>
		</delete>
		<delete failonerror="false" includeemptydirs="true">
			<fileset dir="${deploy.dir}/bin/">
				<include name="*pid" />
			</fileset>
		</delete>
	</target>

	<!-- =================================================================== -->
	<!-- Builds all projects                                                 -->
	<!-- =================================================================== -->
	<target name="build-all" depends="init,build-common,build-dispatcher,build-service">
		<echo>Build all projects.</echo>
	</target>

</project>
